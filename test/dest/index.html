<!DOCTYPE html>
<html>
<head>
    <title>test</title>
</head>
<body>
    halo
    <ltag src="//gulpLocalStore/test/css/index.css" version="1.0"></ltag>
    <ltag src="//gulpLocalStore/test/js/index.js" version="1.0"></ltag>
<script>
function extractFilename(e){return e.slice(e.lastIndexOf("/")+1,e.indexOf("?")!=-1?e.indexOf("?"):void 0)}function extractTag(){for(var e=document.getElementsByTagName("ltag"),t=0,r=e.length;t<r;t++){var s=e[t],o=s.getAttribute("src"),a=extractFilename(o),n=a.slice(a.lastIndexOf(".")+1),c=o.replace(/(\.|_)+(\d|\w){8}\./g,".");c=c.replace(/\/\d+\//,"/");var i=s.getAttribute("version")||a.match(/(\.|_)+(\d|\w){8}\./g)||"0.0";i=i instanceof Array?i[0]:i;var u={url:o,type:n,resourceKey:c,blob:"",version:i};manifest.push(u)}}function relativeUrl(e,t){var r,s=/url\((.+?)\)/g,o=e.slice(0,e.lastIndexOf("/"));return r=t.replace(s,function(e){var t=e.slice(e.indexOf("(")+1,e.indexOf(")"));t.indexOf("'")==-1&&t.indexOf('"')==-1||(t=t.slice(1,t.length-1));for(var r=t.split("/"),s=o,a=0,n=r.length;a<n;a++)if("."===r[a])s=s;else{if(".."!==r[a])break;s=s.slice(0,s.lastIndexOf("/"))}return"url("+s+"/"+r.slice(a).join("/")+")"})}function isAllCSSLoaded(){var e=loaded.cssList;for(var t in e)if(!e[t])return!1;return!0}function appendResource(e){if("css"===e.type){if(doResource(e),loaded.cssList[e.resourceKey]=!0,isAllCSSLoaded())for(var t in loaded.jsList)loaded.jsList[t]&&doResource(loaded.jsList[t])}else"js"===e.type&&(isAllCSSLoaded()?doResource(e):loaded.jsList[e.resourceKey]=e)}function doResource(e){var t=document.getElementsByTagName("head")[0],r=document.getElementsByTagName("body")[0];switch(e.type){case"css":var s=document.createElement("style");s.type="text/css",s.appendChild(document.createTextNode(e.blob)),t.appendChild(s);break;case"js":var o=document.createElement("script");o.type="text/javascript",o.appendChild(document.createTextNode(";(function(){"+e.blob+"})()")),r.appendChild(o)}}function ajax(e,t,r){var s=new XMLHttpRequest;s.open("GET",e),s.onreadystatechange=function(){var e=4,o=200;s.readyState===e&&(s.status===o&&s.responseText?t(s.responseText):r())},s.send(null)}function getResource(e){return JSON.parse(localStorage.getItem(e)||"{}")}function check(){return!!localStorage}function storeResource(e){console.log(e),localStorage.setItem(e.resourceKey,JSON.stringify(e))}function ajaxResource(e){ajax(e.url,function(t){t&&("css"===e.type&&(t=relativeUrl(e.url,t)),appendResource({type:e.type,blob:t,resourceKey:e.resourceKey}),setTimeout(function(){clearResource(e.resourceKey),storeResource({type:e.type,blob:t,resourceKey:e.resourceKey,version:e.version})},500))},function(){e=getResource(e.resourceKey);var t=e.blob;appendResource({type:e.type,blob:t,resourceKey:e.resourceKey})})}function clearResource(e){localStorage.setItem(e,"{}")}function begin(e){if(e.resourceKey=e.resourceKey,check()){var t=getResource(e.resourceKey);t&&t.version===e.version?appendResource(t):ajaxResource(e)}else ajaxResource(e)}function initLoaded(){loaded.cssList={},loaded.jsList={},manifest.forEach(function(e){"css"===e.type?loaded.cssList[e.resourceKey]=!1:"js"===e.type&&(loaded.jsList[e.resourceKey]=!1)})}var manifest=[],loaded=[];extractTag(),initLoaded(),manifest.forEach(begin);
</script>

</body>
</html>